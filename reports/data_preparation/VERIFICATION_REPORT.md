# クリーンデータセット最終検証レポート

**検証日時:** 2025年12月8日  
**検証者:** Antigravity  
**目的:** codebookと照合し、クリーンデータセットに事後情報が含まれていないことの最終確認

---

## ✅ 検証結果: **データリークなし - 使用可能**

全36列をcodebookと照合した結果、**事後情報は完全に除外されており、データリークはありません**。

---

## 📋 全列の詳細検証

### クリーンデータセットの全36列

| # | 列名 | 事前/事後 | codebook確認 | 判定 |
|---|------|----------|-------------|------|
| 1 | ゾーン規制 | **事前** | 発生場所の「ゾーン30」規制の有無 | ✅ |
| 2 | 一時停止規制　標識（当事者A） | **事前** | 交差点進入箇所の一時停止規制 | ✅ |
| 3 | 一時停止規制　標識（当事者B） | **事前** | 同上 | ✅ |
| 4 | 一時停止規制　表示（当事者A） | **事前** | 交差点進入箇所の法定外表示 | ✅ |
| 5 | 一時停止規制　表示（当事者B） | **事前** | 同上 | ✅ |
| 6 | 中央分離帯施設等 | **事前** | 道路の中央部分の交通安全施設 | ✅ |
| 7 | **事故類型** | **🟡 要注意** | 車両相互/人対車両/車両単独/列車 | ⚠️ 確認必要 |
| 8 | 信号機 | **事前** | 信号機の有無 | ✅ |
| 9 | 地形 | **事前** | 平地・坂道等 | ✅ |
| 10 | 地点　経度（東経） | **事前** | 事故発生地点の経度 | ✅ |
| 11 | 地点　緯度（北緯） | **事前** | 事故発生地点の緯度 | ✅ |
| 12 | 地点コード | **事前** | 発生場所コード | ✅ |
| 13 | 天候 | **事前** | 晴・雨・雪等 | ✅ |
| 14 | 市区町村コード | **事前** | 発生場所の市区町村 | ✅ |
| 15 | 年齢（当事者A） | **事前** | 当事者の年齢層 | ✅ |
| 16 | 年齢（当事者B） | **事前** | 同上 | ✅ |
| 17 | 当事者種別（当事者A） | **事前** | 乗用車・歩行者・自転車等 | ✅ |
| 18 | 当事者種別（当事者B） | **事前** | 同上 | ✅ |
| 19 | 昼夜 | **事前** | 昼間・夜間 | ✅ |
| 20 | 曜日(発生年月日) | **事前** | 発生曜日 | ✅ |
| 21 | 歩車道区分 | **事前** | 歩車道の区分状況 | ✅ |
| 22 | **死者数** | **目的変数** | ターゲット変数 | ✅ |
| 23 | 用途別（当事者A） | **事前** | 車両の用途（自家用・事業用等） | ✅ |
| 24 | 用途別（当事者B） | **事前** | 同上 | ✅ |
| 25 | 祝日(発生年月日) | **事前** | 祝日か否か | ✅ |
| 26 | **衝突地点** | **🟡 要注意** | 最初の衝突地点 | ⚠️ 確認必要 |
| 27 | 警察署等コード | **事前** | 管轄警察署 | ✅ |
| 28 | 路線コード | **事前** | 発生道路 | ✅ |
| 29 | 路面状態 | **事前** | 乾燥・湿潤・積雪等 | ✅ |
| 30 | 車道幅員 | **事前** | 道路の幅 | ✅ |
| 31 | 速度規制（指定のみ）（当事者A） | **事前** | 公安委員会指定の最高速度 | ✅ |
| 32 | 速度規制（指定のみ）（当事者B） | **事前** | 同上 | ✅ |
| 33 | 道路形状 | **事前** | 直線・カーブ等 | ✅ |
| 34 | 道路線形 | **事前** | 平坦・上り坂等 | ✅ |
| 35 | 都道府県コード | **事前** | 発生都道府県 | ✅ |
| 36 | 発生日時 | **事前** | 事故発生日時 | ✅ |

---

## 🔍 要注意列の詳細検証

### 1. 事故類型（列7）

**codebook定義**:
```
交通事故の類型をいう。
- 車両相互: 当事者A・Bがいずれも車両等
- 人対車両: 一方が歩行者
- 車両単独: 一方が物件・駐車車両・相手なし
- 列車: 列車が関与する踏切事故
```

**判定**: ✅ **事前情報 - 問題なし**

**理由**:
- 「車両相互」「人対車両」「車両単独」は事故の**発生形態**を示す
- 当事者A・Bの種別から**事故発生時**に観測可能
- 「衝突した」という事実は事故発生時点で明らか
- 事故の**結果**（死亡・負傷）とは独立した情報

---

### 2. 衝突地点（列26）

**codebook定義**:
```
交通事故が発生した最初の衝突地点をいう。
- 交差点内: 交差点内で衝突
- 単路（交差点付近を含む）: 単路・交差点付近で衝突
- その他: 上記以外の衝突地点
```

**判定**: ✅ **事前情報 - 問題なし**

**理由**:
- 「最初の衝突地点」は事故が**発生した場所**を示す
- 事故現場の地理的特徴（交差点か単路か）は事前観測可能
- 事故の**結果**ではなく、**発生場所の分類**

**注意点**:
- ✅ 「衝突地点」= 場所の分類（事前情報）
- ❌ 「車両の衝突部位」= 車両のどこが壊れたか（事後情報・既に除外済み）

これらは**異なる列**であり、混同してはいけません。

---

## ❌ 正しく除外された事後情報列（14列）

比較のため、除外した列も記載します：

| 除外列 | 理由 |
|--------|------|
| 事故内容 | 死亡/負傷の区分そのもの（100%リーク） |
| 人身損傷程度（A・B） | 死亡・重傷・軽傷（事後情報） |
| 負傷者数 | 事故の結果 |
| 車両の損壊程度（A・B） | 衝突の重大性（事後情報） |
| **車両の衝突部位（A・B）** | **車両のどこが壊れたか（事後情報）** |
| エアバッグの装備（A・B） | 作動状況が含まれる可能性（予防的除外） |
| サイドエアバッグの装備（A・B） | 同上 |
| 資料区分、本票番号 | 管理情報 |

---

## 📊 事前情報と事後情報の明確な区別

### ✅ 事前に観測可能な情報（クリーンデータに含まれる）

| カテゴリ | 例 | 理由 |
|---------|---|------|
| **環境条件** | 天候、路面状態、昼夜 | 事故発生時の状況 |
| **道路・地点** | 道路形状、経度・緯度、交差点/単路 | 発生場所の物理的特徴 |
| **規制** | 速度規制、信号機、一時停止 | 事前に設定された規制 |
| **当事者属性** | 年齢、車両種別、用途 | 事故発生前からわかる属性 |
| **事故形態** | 事故類型（車両相互/人対車両等） | 発生時点で観測可能 |
| **時間** | 発生日時、曜日、祝日 | 発生時刻 |

### ❌ 事後にのみわかる情報（除外済み）

| カテゴリ | 例 | 理由 |
|---------|---|------|
| **事故の結果** | 事故内容（死亡/負傷） | 目的変数と100%相関 |
| **人的被害** | 人身損傷程度、負傷者数 | 事故の結果 |
| **物的被害** | 車両の損壊程度、衝突部位 | 事故後の状態 |
| **機器作動** | エアバッグ作動状況 | 衝突時の結果 |

---

## 🎯 実データでの確認

実際のデータサンプル:
```
事故類型  当事者種別A  年齢A  昼夜  天候  死者数
21       3           65    12    5     0
21       17          35    12    2     0
21       11          55    12    1     0
```

- `事故類型 21` = 車Both?両相互
- `当事者種別 3, 17, 11` = 特定の車両種別
- `昼夜 12` = 昼間/夜間
- `天候 5, 2, 1` = 天候条件

すべて**事前観測可能な情報**のみが含まれています。

---

## ✅ 最終判定

### 結論

> [!NOTE]
> **検証完了**: クリーンデータセット`honhyo_clean_no_leakage.csv`は、事後情報を含まず、**データリークの危険はありません**。
>
> 全36列をcodebookと照合した結果、すべてが事前に観測可能な情報であることを確認しました。

### 品質保証

| 検証項目 | 結果 | 詳細 |
|---------|------|------|
| 事後情報列の除外 | ✅ 完了 | 14列すべて除外済み |
| 残存列のcodebook照合 | ✅ 完了 | 36列すべて確認済み |
| 疑わしい列の詳細調査 | ✅ 完了 | 事故類型・衝突地点を検証 |
| データサンプル確認 | ✅ 問題なし | 実データで再確認 |

### 使用許可

**このデータセットは機械学習モデルの学習に安全に使用できます。**

---

## 📌 今後の注意点

1. **列名の混同に注意**:
   - ✅ `衝突地点` = 場所の分類（事前情報・使用可）
   - ❌ `車両の衝突部位` = 車両の損傷箇所（事後情報・除外済み）

2. **新しい列を追加する場合**:
   - 必ずcodebookで定義を確認
   - 「事故発生前に観測可能か？」を厳密に判定
   - 少しでも疑わしい場合は除外

3. **定期的な検証**:
   - データソース更新時は再検証が必要
   - 列が追加されていないか確認

---

## 🔗 関連ドキュメント

- [クリーンデータREADME](file:///c:/Users/socce/software-lab/traffic-accident/data/processed/README_clean_dataset.md)
- [データ作成スクリプト](file:///c:/Users/socce/software-lab/traffic-accident/scripts/data_processing/create_clean_dataset.py)
- [Codebook](file:///c:/Users/socce/software-lab/traffic-accident/data/codebook/codebook_2024_extracted.txt)
- [データリーク監査レポート](file:///c:/Users/socce/software-lab/traffic-accident/results/experiments/comprehensive_data_leakage_audit.md)
