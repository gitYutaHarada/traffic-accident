# 実験レポート一覧

このディレクトリには、プロジェクト全体で実施した実験のレポートファイルがカテゴリ別に整理されています。

## 📁 ディレクトリ構成

```
reports/
├── data_quality/          # データ品質・検証関連 (3ファイル)
├── feature_engineering/   # 特徴量エンジニアリング (6ファイル)
├── model_evaluation/      # モデル評価・性能検証 (3ファイル)
├── analysis/              # 分析・解釈レポート (2ファイル)
├── tuning/                # ハイパーパラメータチューニング (3ファイル)
├── model_comparison/      # モデル比較分析 (2ファイル)
└── data_preparation/      # データ準備・前処理 (1ファイル)
```

---

## 📊 レポート一覧（カテゴリ別）

### 1. データ品質・検証（data_quality/）

| ファイル名 | 内容 | 重要度 |
|-----------|------|--------|
| `comprehensive_data_leakage_audit.md` | 全実験のデータ漏洩包括監査 | ⭐⭐⭐⭐⭐ |
| `data_leakage_investigation.md` | データ漏洩調査の詳細 | ⭐⭐⭐⭐ |
| `correlation_summary.md` | 特徴量間の相関分析 | ⭐⭐⭐ |

**主な発見**:
- 過去の実験でデータ漏洩が発生していたことを特定
- 事後情報（負傷者数、車両損壊程度など）を除外する必要性を確認

---

### 2. 特徴量エンジニアリング（feature_engineering/）

| ファイル名 | 内容 | 効果 |
|-----------|------|------|
| `categorical_datetime_experiment.md` | カテゴリカル変数と日時分解の実験 | PR-AUC向上 |
| `area_granularity_report.md` | エリア粒度実験（詳細） | Feature Importance 1位 |
| `area_granularity_low_report.md` | エリア粒度実験（低解像度） | - |
| `interactions_report.md` | 交互作用特徴量の実験 | 重要度上位だが精度低下 |
| `day_of_month_analysis.md` | 日付特徴量の分析 | 軽微な効果 |
| `road_type_report.md` | 道路タイプ特徴量の実験 | - |

**主な成果**:
- エリアID化（MiniBatchKMeans）が最も効果的な特徴量
- カウントエンコーディングで約1.2%のF1向上
- 交互作用特徴量は慎重に選択する必要あり

---

### 3. モデル評価・性能検証（model_evaluation/）

| ファイル名 | 内容 | PR-AUC |
|-----------|------|--------|
| `final_evaluation_report.md` | 最終モデルの包括評価 | **0.2056** ⭐ |
| `model_no_leakage_report.md` | データ漏洩除去後の評価 | - |
| `model_lightgbm_area_report.md` | エリアID導入後の評価 | - |

**最終モデル性能**:
- PR-AUC: **0.2056** (テストセット)
- ROC-AUC: 0.8879
- 死亡事故の70%を検知可能（閾値0.1時）

---

### 4. 分析・解釈（analysis/）

| ファイル名 | 内容 | 手法 |
|-----------|------|------|
| `shap_analysis_report.md` | SHAP値による特徴量解釈 | SHAP |
| `mortality_rate_analysis.md` | 死亡率の分析 | 統計分析 |

**主な知見**:
- 年齢、用途別、地理的位置が死亡リスクの主要因
- モデルは納得感のあるリスク要因に基づいて判断

---

### 5. ハイパーパラメータチューニング（tuning/）

| ファイル名 | 内容 | 試行数 |
|-----------|------|--------|
| `LightGBMチューニング最終レポート.md` | Optuna使用、最良PR-AUC達成 | 200試行 |
| `チューニング実験結果_20251209.md` | 初期チューニング実験 | - |
| `インポート完了ガイド.md` | チューニング結果のインポート手順 | - |

**最良パラメータ**:
- Trial 153でPR-AUC **0.1779**達成（CV平均）
- 強い正則化（min_child_samples=278, reg_lambda=8.23）

---

### 6. モデル比較（model_comparison/）

| ファイル名 | 内容 | 比較対象 |
|-----------|------|---------|
| `lightgbm_vs_logreg.md` | LightGBM vs ロジスティック回帰 | 2モデル |
| `logistic_regression_report.md` | ロジスティック回帰の詳細評価 | - |

**比較結果**:
- LightGBM PR-AUC: 0.2056
- ロジスティック回帰 PR-AUC: 0.0566
- **LightGBMが263%優位**

---

### 7. データ準備（data_preparation/）

| ファイル名 | 内容 |
|-----------|------|
| `VERIFICATION_REPORT.md` | データセット検証レポート |

---

## 🎯 主要な実験結果サマリー

### 最良モデル性能

| 指標 | 値 | 備考 |
|------|-----|------|
| **PR-AUC** | **0.2056** | LightGBM（テストセット） |
| PR-AUC (CV) | 0.1779 | 5-fold交差検証平均 |
| ROC-AUC | 0.8879 | 高い識別能力 |
| F1 Score | 0.2883 | 最適閾値時 |

### データセット

- **レコード数**: 1,895,275件
- **特徴量数**: 33
- **クラス不均衡比**: 115.51:1
- **データソース**: `honhyo_clean_predictable_only.csv`

### 最重要特徴量（Top 3）

1. **地点 緯度** - 地理的位置が最重要
2. **地点 経度** - 地理的位置が最重要
3. **市区町村コード** - 地域特性の影響大

---

## 📅 実験の時系列

1. **2025年12月4日**: データ品質調査、SHAP分析
2. **2025年12月7日**: 特徴量エンジニアリング（カテゴリカル、日時、エリアID）
3. **2025年12月8日**: データ漏洩包括監査
4. **2025年12月9-10日**: ハイパーパラメータチューニング（Optuna 200試行）
5. **2025年12月11日**: 最終評価、モデル比較

---

## 💡 重要な教訓

### ✅ 成功したアプローチ

1. **エリアID化**: 緯度経度のクラスタリングが Feature Importance 1位
2. **強い正則化**: 過学習を防ぎ汎化性能向上
3. **データ漏洩の徹底排除**: 事後情報を完全に除外

### ⚠️ 注意が必要なアプローチ

1. **交互作用特徴量**: 重要度は高いが精度低下の可能性
2. **過度な特徴量追加**: モデルが複雑化し過学習リスク

---

## 📖 レポートの使い方

### 新しい実験を追加する場合

適切なカテゴリディレクトリに`.md`ファイルを追加：
- データの品質検証 → `data_quality/`
- 新しい特徴量の実験 → `feature_engineering/`
- モデル性能の評価 → `model_evaluation/`
- データ分析・可視化 → `analysis/`

### レポート命名規則

- `{実験名}_report.md`: 汎用レポート
- `{手法名}_experiment.md`: 特定手法の実験
- `{モデルA}_vs_{モデルB}.md`: モデル比較

---

**最終更新**: 2025年12月11日  
**整理完了**: 全20ファイルをカテゴリ別に分類完了  
**管理**: traffic-accident プロジェクト
