# 特徴量選択後 Two-Stage モデル実験レポート
        
**実行日時**: 2025-12-19 15:48:31

## 研究背景
不均衡データ（1:118）における交通事故の死亡予測において、モデルの精度向上と安定化を目指しています。これまでの実験で多くの特徴量を使用してきましたが、中にはノイズ（予測に寄与しない、あるいは悪影響を与える）や冗長な特徴量が含まれている可能性がありました。そこで、Permutation Importance（順列重要度）分析を実施し、LogLossを指標として特徴量の選別を行いました。

## 研究内容
Permutation Importance分析に基づき、「削除推奨（Importance <= 0）」と判定された29個の特徴量を削除して、モデルの再学習と評価を行いました。
- **削除対象**: 地形、昼夜、車道幅員、hour、道路線形など29項目
- **保護対象**: `prob_stage1`, `logits_stage1`, `area_id` は重要度に関わらず維持
- **モデル構成**: Two-Stage Model (Stage 1: LightGBM / Stage 2: LightGBM + DAE)
- **目的**: 特徴量削減による「精度の向上（ノイズ除去効果）」または「計算コストの削減」が達成できるかを検証する。

## 設定
- 削除特徴量: 29件
- Stage 1 Recall Target: 95%

## 結果
### CV OOF (閾値 0.5)
- Precision: 0.5589
- Recall: 0.0128
- F1: 0.0249
- AUC: 0.8312

### 動的閾値 (CV OOF)
- Recall 99%: Precision 0.0138

## Baseline（全特徴量）との比較

| 項目 | Baseline (Full Features) | Selected Features (29 Removed) | 変化 |
| :--- | :--- | :--- | :--- |
| **特徴量数** | 35 | 6 | -29 (83%削減) |
| **Stage 1 Recall** | 100.00% (Target 99%) | 95.03% (Target 95%) | -4.97% |
| **Filtering Rate** | 0.00% | 38.04% | +38.04% |
| **Global AUC** | 0.8568 | 0.8312 | -0.0256 |
| **Precision** (0.5) | 0.6071 | 0.5589 | -0.0482 |
| **Recall** (0.5) | 0.0405 | 0.0128 | -0.0277 |
| **F1** (0.5) | 0.0759 | 0.0249 | -0.0510 |

### 考察
1.  **性能低下**: 特徴量を大幅（29個）に削除した結果、AUCおよびPrecision/Recallすべての指標で性能が低下しました。削除された特徴量の中に、非線形な関係性を持つ重要な情報が含まれていた可能性があります。
2.  **Stage 1の影響**: Baselineは実質フィルタリングなし（Recall 100%）だったのに対し、今回は38%のデータをStage 1で除外しています。これにより計算コストは下がりましたが、Stage 2での挽回の余地が減ったことも影響していると考えられます。
3.  **結論**: 単純な「削除」は逆効果でした。次は「削除」ではなく「重要な特徴量のみを厳選してStage 1を作る」または「LGBMの正則化で対応する」方針が良いかもしれません。
