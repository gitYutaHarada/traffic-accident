# Hard Examples 分析レポート

## 概要

このレポートは、アンサンブルモデルが予測を大きく外した「Hard Examples (予測困難事例)」の分析結果をまとめたものです。

### 抽出された Hard Examples

| カテゴリ | 件数 | 閾値 |
|---------|------|------|
| **見逃し (Hard FN)** | 1276 件 | prob < 0.0058 |
| **過剰検知 (Hard FP)** | 8653 件 | prob > 0.1465 |
| 比較用 Easy TP | 5875 件 | - |
| 比較用 Easy TN | 432606 件 | - |

---

## 見逃し (Hard FN) の特徴

Hard FN と Easy TP を比較した結果、以下の特徴量で分布が大きく異なることが判明しました。

| 特徴量 | KS統計量 | p値 | 平均差 |
|--------|----------|-----|--------|
| 当事者種別（当事者A） | 0.3739 | 1.89e-131 | -7.50 |
| 昼夜 | 0.3691 | 5.26e-128 | -3.68 |
| 道路形状 | 0.3662 | 5.77e-126 | -4.37 |
| 地形 | 0.3196 | 2.13e-95 | -0.55 |
| 市区町村コード | 0.1846 | 9.98e-32 | -44.05 |


---

## 過剰検知 (Hard FP) の特徴

Hard FP と Easy TN を比較した結果、以下の特徴量で分布が大きく異なることが判明しました。

| 特徴量 | KS統計量 | p値 | 平均差 |
|--------|----------|-----|--------|
| 地形 | 0.4470 | 0.00e+00 | 0.77 |
| 道路形状 | 0.3999 | 0.00e+00 | 4.58 |
| 昼夜 | 0.3804 | 0.00e+00 | 3.73 |
| 当事者種別（当事者A） | 0.3741 | 0.00e+00 | 5.73 |
| 市区町村コード | 0.2533 | 0.00e+00 | 59.92 |


---

## 個別事例の深掘り (SHAP分析)

最も誤分類がひどかったTop 3事例について、SHAPを用いて要因分析を行いました。
詳細は以下のファイルを参照してください:

- `shap_waterfall_hard_fn_1.png`, `shap_waterfall_hard_fn_2.png`, `shap_waterfall_hard_fn_3.png` (見逃し)
- `shap_waterfall_hard_fp_1.png`, `shap_waterfall_hard_fp_2.png`, `shap_waterfall_hard_fp_3.png` (過剰検知)

---

## 結論と改善提案

1. **見逃しの傾向**: Hard FN は特定の条件下で発生しやすい可能性があります。上記の分布比較結果を参考に、モデルへの特徴量追加や重み調整を検討してください。
2. **過剰検知の傾向**: Hard FP は「危険に見えるが実際は死亡に至らなかった事故」を拾っている可能性があります。閾値の調整やフィルタリングロジックの追加を検討してください。
3. **次のステップ**: 特定の条件（例：特定の道路形状、地形）に特化した専門家モデル (Mixture of Experts) の導入を検討する価値があります。

