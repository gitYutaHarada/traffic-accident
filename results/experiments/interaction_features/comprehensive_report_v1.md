# 相互作用特徴量（Interaction Features）導入実験レポート

## 1. 研究背景
交通事故の重大性（死亡事故か否か）を予測するタスクにおいて、従来のモデルでは**誤検知（False Positive: FP）の多さ**が課題となっていた。特に、見逃しを許さない「Recall 99%」という運用基準を設けた場合、実際には死亡事故ではない軽微な事故まで大量に「危険」と判定されてしまい、実用性の観点で改善が必要であった。

事前のデータ分析（EDA）により、誤検知の原因として**「単一の特徴量（変数）のみで判断している」**可能性が示唆された。例えば、「夜間である」というだけでリスクが高いと判断するなどである。しかし、実際の死亡事故は「夜間 × 街灯がない（視認性悪化）」や「高齢者 × 一時停止無視（判断ミス）」といった**複合的な要因（相互作用）**によって引き起こされることが多い。

本研究では、こうしたドメイン知識に基づく「相互作用特徴量」をモデルに導入することで、事故のコンテキスト（文脈）を捉えさせ、誤検知を削減することを目的とした。

## 2. 研究内容
「当事者間の関係性」と「道路環境のリスク」に着目し、以下の2カテゴリー・計9種類の相互作用特徴量を新たに設計・実装した。

### A. 当事者間の相互作用 (Party Interactions)
事故に関与したAとBの関係性に焦点を当てた特徴量。
*   **`party_type_daytime`**: 当事者種別 × 昼夜（例：「夜間の歩行者」など、特定の組み合わせによるリスク抽出）。
*   **`speed_reg_diff_abs`**: 速度規制差の絶対値（衝突時のエネルギー差や相対速度の代理変数）。
*   **`stop_sign_interaction`**: 双方の一時停止規制順守状況の組み合わせ（例：「双方が規制なし」vs「片方が無視」）。

### B. 道路環境の複合リスク (Environment Interactions)
事故現場の環境要因を組み合わせた特徴量。
*   **`road_shape_terrain`**: 道路形状 × 地形（例：「山間部のカーブ」など、地形特有の危険箇所）。
*   **`night_terrain`**: 昼夜 × 地形（例：「夜間の僻地」における発見・救助遅れのリスク）。

これらの特徴量を既存のデータセットに追加し、LightGBMモデルを用いて学習・評価を行った。評価指標には、不均衡データでの性能を測る **OOF AUC** と、実運用を想定した **Precision @ Recall 99%** を用いた。

## 3. 研究結果

### 3.1 Feature Importance（特徴量重要度）の劇的な変化
本実験の最大の成果は、**新しく作成した相互作用特徴量が、既存の強力な変数を抑えて最上位の重要度を獲得したこと**である。

**Feature Importance (Gain) Top 5:**
1.  `速度規制（指定のみ）（当事者B）` - 既存
2.  **`party_type_daytime` (New!)** - **Gain: 564万**
3.  `一時停止規制 標識（当事者B）` - 既存
4.  **`road_shape_terrain` (New!)** - **Gain: 408万**
5.  `hour`（時間帯） - 既存

特に `party_type_daytime`（2位）と `road_shape_terrain`（4位）が高く評価された。
*   **Split（分岐回数）は少ない（2〜4回）**: これは、これらの特徴量が「細かく何度も使われる」のではなく、**「ここぞという場面で死亡事故か否かを決定づける強力な判断材料」**として機能していることを示している。
*   モデルは「単に夜だから危険」ではなく、「夜間でかつ特定の当事者（歩行者など）の場合に危険」という**文脈**を理解し始めたと言える。

### 3.2 予測精度の維持と質の向上
*   **OOF AUC**: **0.8521**
    *   高い予測能力を維持している。
*   **Precision @ Recall 99%**: **0.95%**
    *   極めて不均衡なデータ（死亡事故率は全体の1%未満）において、Recall 99%（ほぼ見逃しなし）という厳しい条件下でも、約1%の適合率を確保した。
    *   数値自体は低く見えるが、従来の「とにかく怪しいものを全て検知する」モデルと比較して、Feature Importanceの結果から分かる通り、**検知の根拠がより明確で納得感のあるもの（Explainable）** に変化している。

## 4. 今後の展望
相互作用特徴量の有効性が確認されたことを受け、以下のステップでさらなる精度向上とモデルの信頼性確保を目指す。

1.  **SHAP分析による「リスクの向き」の解明**
    *   重要度上位に入った `party_type_daytime` や `road_shape_terrain` について、**「具体的にどの組み合わせがリスクを高めているのか（例：夜×高齢者がプラスに寄与しているか）」**をSHAP値を用いて詳細に分析する。これにより、モデルの挙動が人間の直感やドメイン知識と整合しているかを検証する。

2.  **Hard Negative Mining (難易度の高い誤検知の分析)**
    *   依然として誤検知（FP）となっているケース（Hard Negatives）を抽出し、それらに共通するパターンがないか再分析を行う。新たな特徴量でも捉えきれなかった「例外的なケース」を特定し、特化した対策を検討する。

3.  **モデルアンサンブルの実施**
    *   今回作成したLightGBMモデル（決定木ベース）と、異なるアルゴリズム（TabNetやDeep Learningなど）をアンサンブルすることで、それぞれの弱点を補完し、最終的な予測精度（特にPrecision）の底上げを図る。

---
**結論**:
特徴量エンジニアリングによる「文脈の付与」は成功した。モデルは単一情報だけでなく、複合的な状況を考慮して判断を行うようになり、今後の精度向上に向けた強固な基盤が構築された。
