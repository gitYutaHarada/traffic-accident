# å…¨å®Ÿé¨“ã®ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ

**ç›£æŸ»æ—¥æ™‚:** 2025å¹´12æœˆ8æ—¥  
**ç›£æŸ»è€…:** Antigravity  
**ç›®çš„:** éå»ã«å®Ÿæ–½ã—ãŸã™ã¹ã¦ã®å®Ÿé¨“ã«ãŠã„ã¦ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã‹åŒ…æ‹¬çš„ã«èª¿æŸ»

---

## ğŸ” ç›£æŸ»çµæœã‚µãƒãƒªãƒ¼

### ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã®çŠ¶æ³

**çµè«–**: **ã™ã¹ã¦ã®å®Ÿé¨“ã§ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ãŒç™ºç”Ÿã—ã¦ã„ã¾ã—ãŸ**

| å®Ÿé¨“ | ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ | æ‹¬å¼§ã®ç¨®é¡ | çŠ¶æ…‹ |
|------|-----------|-------------|-----------|------|
| Optunaæœ€é©åŒ– | `lightgbm_optuna_tuning.py` | **ğŸ”´ ã‚ã‚Š** | åŠè§’ `(` | é™¤å¤–å¤±æ•— |
| LightGBM Weight | `lightgbm_weighted_optimization.py` | **ğŸ”´ ã‚ã‚Š** | å…¨è§’ `ï¼ˆ` | é™¤å¤–å¤±æ•— (ãƒ‡ãƒ¼ã‚¿ã«åˆ—ãŒå­˜åœ¨) |
| LightGBM SMOTE | `lightgbm_smote_optimization.py` | **ğŸ”´ ã‚ã‚Š** | å…¨è§’ `ï¼ˆ` | é™¤å¤–å¤±æ•— (ãƒ‡ãƒ¼ã‚¿ã«åˆ—ãŒå­˜åœ¨) |
| RF Refined | `random_forest_refined.py` | **ğŸ”´ ã‚ã‚Š** | å…¨è§’ `ï¼ˆ` | é™¤å¤–å¤±æ•— (ãƒ‡ãƒ¼ã‚¿ã«åˆ—ãŒå­˜åœ¨) |
| RF Analysis | `random_forest_analysis.py` | **ğŸ”´ æœ€æ‚ª** | - | äº‹å¾Œæƒ…å ±ã‚’å…¨ãé™¤å¤–ã›ãš |

> [!CAUTION]
> **ã™ã¹ã¦ã®å®Ÿé¨“ãŒç„¡åŠ¹**: å ±å‘Šã•ã‚ŒãŸã™ã¹ã¦ã®é«˜æ€§èƒ½ï¼ˆRecall 82%~96%, Precision 55%ãªã©ï¼‰ã¯ã€äº‹æ•…ã®**çµæœ**ã‚’è¦‹ã¦äºˆæ¸¬ã—ã¦ã„ãŸãŸã‚ã€å®Ÿç”¨æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

---

## ğŸ“Š è©³ç´°åˆ†æ

### 1. ãƒ‡ãƒ¼ã‚¿ã«å­˜åœ¨ã™ã‚‹äº‹å¾Œæƒ…å ±åˆ—ï¼ˆå…¨ã¦ç¢ºèªæ¸ˆã¿ï¼‰

```
âœ“ äº‹æ•…å†…å®¹                    â† æ­»äº¡/è² å‚·ã®åŒºåˆ†ï¼ˆ100%ãƒªãƒ¼ã‚¯ï¼‰
âœ“ äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰      â† æ­»äº¡ãƒ»é‡å‚·ãƒ»è»½å‚·ï¼ˆæ¥µã‚ã¦é«˜ãƒªãƒ¼ã‚¯ï¼‰
âœ“ äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Bï¼‰      â† åŒä¸Š
âœ“ è»Šä¸¡ã®æå£Šç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰    â† è¡çªã®é‡å¤§æ€§
âœ“ è»Šä¸¡ã®æå£Šç¨‹åº¦ï¼ˆå½“äº‹è€…Bï¼‰    â† åŒä¸Š
âœ“ è² å‚·è€…æ•°                    â† äº‹æ•…ã®é‡å¤§æ€§
âœ“ è»Šä¸¡ã®è¡çªéƒ¨ä½ï¼ˆå½“äº‹è€…Aï¼‰    â† äº‹æ•…å¾Œã®æƒ…å ±
âœ“ è»Šä¸¡ã®è¡çªéƒ¨ä½ï¼ˆå½“äº‹è€…Bï¼‰    â† åŒä¸Š
```

**æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰çµæœ**:
```
åˆè¨ˆ: 8/8åˆ—ãŒå­˜åœ¨
```

å…¨ã¦ã®äº‹å¾Œæƒ…å ±åˆ—ãŒ`honhyo_model_ready.csv`ã«å­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚

### 2. å„å®Ÿé¨“ã®è©³ç´°

#### (1) Optuna Tuning - lightgbm_optuna_tuning.py

**å•é¡Œ**: æ‹¬å¼§ãŒ**åŠè§’** `(` ã§è¨˜è¿°

```python
drop_cols = [
    "äººèº«æå‚·ç¨‹åº¦(å½“äº‹è€…A)",  # â† åŠè§’
    "äººèº«æå‚·ç¨‹åº¦(å½“äº‹è€…B)",
    # ... ä»–ã‚‚åŠè§’
]
```

**å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿åˆ—**: `äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰` (å…¨è§’)

**çµæœ**: `errors='ignore'`ã«ã‚ˆã‚Šã€ãƒãƒƒãƒã›ãšã™ã¹ã¦æ®‹å­˜

---

#### (2) LightGBM Weighted - lightgbm_weighted_optimization.py

**å•é¡Œ**: æ‹¬å¼§ãŒ**å…¨è§’** `ï¼ˆ` ã§æ­£ã—ãè¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ãŒã€ãƒ‡ãƒ¼ã‚¿ã«åˆ—ãŒå­˜åœ¨

```python
drop_cols = [
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰',  # â† å…¨è§’ (æ­£ã—ã„)
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Bï¼‰',
    # ...
    'äº‹æ•…å†…å®¹'
]
```

**å•é¡Œç‚¹**: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨˜è¿°ã¯æ­£ã—ã„ãŒã€**å…ƒãƒ‡ãƒ¼ã‚¿`honhyo_model_ready.csv`ã«åˆ—ãŒæ®‹ã£ã¦ã„ã‚‹**

**æ¨å®šåŸå› **: ãƒ‡ãƒ¼ã‚¿å‰å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§é™¤å¤–ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§

---

#### (3) LightGBM SMOTE - lightgbm_smote_optimization.py

**çŠ¶æ³**: LightGBM Weightedã¨åŒæ§˜

```python
drop_cols = [
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰',  # å…¨è§’
    # ...
]
```

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: `data/raw/honhyo_all_shishasuu_binary.csv`

**çµæœ**: é™¤å¤–ãƒªã‚¹ãƒˆã¯æ­£ã—ã„ãŒã€å…ƒãƒ‡ãƒ¼ã‚¿ã«åˆ—ãŒå­˜åœ¨ã™ã‚Œã°æ®‹å­˜

---

#### (4) Random Forest Refined - random_forest_refined.py

**çŠ¶æ³**: åŒä¸Š

```python
drop_cols = [
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰',  # å…¨è§’
    'äº‹æ•…å†…å®¹',  # â† æœ€ã‚‚è‡´å‘½çš„
]
```

ã‚³ãƒ¡ãƒ³ãƒˆã§ã€Œãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯åŸå› ï¼ˆæ­»äº¡/è² å‚·ã®åŒºåˆ†ãã®ã‚‚ã®ï¼‰ã€ã¨è¨˜è¼‰ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã«ã¯é™¤å¤–ã•ã‚Œã¦ã„ãªã„ã€‚

---

#### (5) Random Forest Analysis - random_forest_analysis.py

**å•é¡Œ**: **äº‹å¾Œæƒ…å ±ã‚’å…¨ãé™¤å¤–ã—ã¦ã„ãªã„**

```python
drop_cols = ['è³‡æ–™åŒºåˆ†', 'æœ¬ç¥¨ç•ªå·']  # IDã‚„ç®¡ç†ç•ªå·ã®ã¿
```

**çµæœ**: ã™ã¹ã¦ã®äº‹å¾Œæƒ…å ±ãŒãƒ¢ãƒ‡ãƒ«ã«æŠ•å…¥ã•ã‚Œã¦ã„ã‚‹

> [!WARNING]
> **æœ€ã‚‚æ·±åˆ»**: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯æ„å›³çš„ã«äº‹å¾Œæƒ…å ±ã‚’é™¤å¤–ã—ã¦ã„ãªã„ãŸã‚ã€ã»ã¼100%ã«è¿‘ã„ç²¾åº¦ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

---

## ğŸ” æ ¹æœ¬åŸå› ã®åˆ†æ

### å•é¡Œ1: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã«äº‹å¾Œæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«**:
- `data/processed/honhyo_model_ready.csv` â† OptunaãŒä½¿ç”¨
- `data/raw/honhyo_all_shishasuu_binary.csv` â† ãã®ä»–ãŒä½¿ç”¨

ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«ã€äº‹å¾Œæƒ…å ±åˆ—ãŒé™¤å¤–ã•ã‚Œã¦ã„ãªã„ã€‚

### å•é¡Œ2: errors='ignore'ã®ä½¿ç”¨

```python
df_clean = df.drop(columns=drop_cols, errors='ignore')
```

åˆ—åãŒãƒãƒƒãƒã—ãªã„å ´åˆã€**é™ã‹ã«å¤±æ•—**ã—ã¾ã™ã€‚assertionã«ã‚ˆã‚‹æ¤œè¨¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

### å•é¡Œ3: å…¨è§’/åŠè§’ã®æ··åœ¨

- ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´: åŠè§’ `(` ã¾ãŸã¯ å…¨è§’ `ï¼ˆ`
- ãƒ‡ãƒ¼ã‚¿å´: å…¨è§’ `ï¼ˆ`

ã“ã®ä¸ä¸€è‡´ã«ã‚ˆã‚Šã€ä¸€éƒ¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§é™¤å¤–ãŒå¤±æ•—ã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ“‹ å„å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆã®ä¿¡é ¼æ€§è©•ä¾¡

| å®Ÿé¨“ãƒ¬ãƒãƒ¼ãƒˆ | ä¿¡é ¼æ€§ | æ¨å®šã•ã‚Œã‚‹çœŸã®æ€§èƒ½ |
|-------------|--------|-------------------|
| `optuna_tuning_experiment.md` | **âŒ ç„¡åŠ¹** | Recall: 10-30%, Precision: 5-20% |
| `weighted_model_experiment.md` | **âŒ ç„¡åŠ¹** | Recall: 10-30%, Precision: 5-20% |
| `advanced_model_experiment.md` | **âŒ ç„¡åŠ¹** | Recall: 5-20%, Precision: 5-20% |
| `refined_model_experiment.md` | **âŒ ç„¡åŠ¹** | Recall: 5-20%, Precision: 20-40% |
| åˆæœŸRF Analysis | **âŒ å®Œå…¨ç„¡åŠ¹** | ã»ã¼100%ã«è¿‘ã„è™šå½ã®ç²¾åº¦ |

---

## ğŸ› ï¸ ä¿®æ­£ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### Phase 1: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ä¿®æ­£ï¼ˆå¿…é ˆï¼‰

```python
# data/processed/honhyo_model_ready.csvã‚’å†ä½œæˆ
drop_cols = [
    'è³‡æ–™åŒºåˆ†', 'æœ¬ç¥¨ç•ªå·',
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰',  # å…¨è§’
    'äººèº«æå‚·ç¨‹åº¦ï¼ˆå½“äº‹è€…Bï¼‰',
    'è»Šä¸¡ã®æå£Šç¨‹åº¦ï¼ˆå½“äº‹è€…Aï¼‰',
    'è»Šä¸¡ã®æå£Šç¨‹åº¦ï¼ˆå½“äº‹è€…Bï¼‰',
    'è² å‚·è€…æ•°',
    'è»Šä¸¡ã®è¡çªéƒ¨ä½ï¼ˆå½“äº‹è€…Aï¼‰',
    'è»Šä¸¡ã®è¡çªéƒ¨ä½ï¼ˆå½“äº‹è€…Bï¼‰',
    'ã‚¨ã‚¢ãƒãƒƒã‚°ã®è£…å‚™ï¼ˆå½“äº‹è€…Aï¼‰',
    'ã‚¨ã‚¢ãƒãƒƒã‚°ã®è£…å‚™ï¼ˆå½“äº‹è€…Bï¼‰',
    'ã‚µã‚¤ãƒ‰ã‚¨ã‚¢ãƒãƒƒã‚°ã®è£…å‚™ï¼ˆå½“äº‹è€…Aï¼‰',
    'ã‚µã‚¤ãƒ‰ã‚¨ã‚¢ãƒãƒƒã‚°ã®è£…å‚™ï¼ˆå½“äº‹è€…Bï¼‰',
    'äº‹æ•…å†…å®¹',  # â† æœ€é‡è¦
]

# é™¤å¤–ã®æ¤œè¨¼ã‚’è¿½åŠ 
for col in drop_cols:
    if col in df.columns:
        raise ValueError(f"åˆ— '{col}' ãŒãƒ‡ãƒ¼ã‚¿ã«æ®‹ã£ã¦ã„ã¾ã™ï¼")
```

### Phase 2: å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£

1. å…¨è§’æ‹¬å¼§ã«çµ±ä¸€: `ï¼ˆ` ã‚’ä½¿ç”¨
2. Assertionè¿½åŠ : é™¤å¤–å¾Œã«åˆ—ã®å­˜åœ¨ã‚’ç¢ºèª
3. `errors='ignore'`ã®å‰Šé™¤ã¾ãŸã¯æ…é‡ãªä½¿ç”¨

### Phase 3: å†å®Ÿé¨“ã®å®Ÿæ–½

ã™ã¹ã¦ã®å®Ÿé¨“ã‚’**ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯é™¤å»å¾Œã®ãƒ‡ãƒ¼ã‚¿**ã§å†å®Ÿè¡Œ:

1. Random Forest (baseline)
2. LightGBM + Weight
3. LightGBM + SMOTE
4. Optuna Tuning

---

## ğŸ“Œ çµè«–

> [!IMPORTANT]
> **å…¨å®Ÿé¨“ãŒç„¡åŠ¹**: éå»ã«å ±å‘Šã•ã‚ŒãŸã™ã¹ã¦ã®é«˜æ€§èƒ½ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯ã«ã‚ˆã‚‹è™šå½ã®çµæœã§ã™ã€‚
>
> **ç·Šæ€¥å¯¾å¿œãŒå¿…è¦**: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰äº‹å¾Œæƒ…å ±ã‚’å®Œå…¨ã«é™¤å¤–ã—ã€ã™ã¹ã¦ã®å®Ÿé¨“ã‚’å†å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### æ¨å¥¨ã•ã‚Œã‚‹æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯èª¿æŸ»å®Œäº†ï¼ˆæœ¬ãƒ¬ãƒãƒ¼ãƒˆï¼‰
2. â¬œ **ç·Šæ€¥**: ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã®ä¿®æ­£
3. â¬œ å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä¿®æ­£ã¨æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
4. â¬œ ã™ã¹ã¦ã®å®Ÿé¨“ã®å†å®Ÿè¡Œ
5. â¬œ æ—¢å­˜ãƒ¬ãƒãƒ¼ãƒˆã¸ã®è­¦å‘Šè¿½åŠ 

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

### ç›£æŸ»å¯¾è±¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- [lightgbm_optuna_tuning.py](file:///c:/Users/socce/software-lab/traffic-accident/scripts/analysis/lightgbm_optuna_tuning.py)
- [lightgbm_weighted_optimization.py](file:///c:/Users/socce/software-lab/traffic-accident/scripts/analysis/lightgbm_weighted_optimization.py)
- [lightgbm_smote_optimization.py](file:///c:/Users/socce/software-lab/traffic-accident/scripts/analysis/lightgbm_smote_optimization.py)
- [random_forest_refined.py](file:///c:/Users/socce/software-lab/traffic-accident/scripts/analysis/random_forest_refined.py)
- [random_forest_analysis.py](file:///c:/Users/socce/software-lab/traffic-accident/scripts/analysis/random_forest_analysis.py)

### ç„¡åŠ¹åŒ–ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆ
- [optuna_tuning_experiment.md](file:///c:/Users/socce/software-lab/traffic-accident/results/experiments/optuna_tuning_experiment.md)
- [weighted_model_experiment.md](file:///c:/Users/socce/software-lab/traffic-accident/results/experiments/weighted_model_experiment.md)
- [advanced_model_experiment.md](file:///c:/Users/socce/software-lab/traffic-accident/results/experiments/advanced_model_experiment.md)
- [refined_model_experiment.md](file:///c:/Users/socce/software-lab/traffic-accident/results/experiments/refined_model_experiment.md)
