# Spatio-Temporal モデル実験結果詳細分析レポート

## 1. エグゼクティブサマリー

今回の実験（Spatio-Temporal Stage2）では、**MLP（Multi-Layer Perceptron）モデルが驚異的なTop-k精度を達成**しました。特に、モデルが最も確信度が高いと判断した上位100件の予測において、**99%の正解率（Precision@100 = 0.99）**を記録しており、高リスク地点の特定において極めて有効であることが示されました。

一方で、比較対象として予定していた**kNN-GNNモデル**は、学習時のグラフ構造と検証時のグラフ構造の不一致（Transductiveな設定の問題）によりエラーとなりました。今後はInductiveな学習設定への修正が必要です。

## 2. 詳細パフォーマンス分析 (MLPモデル)

| 指標 | 結果 | 評価 |
| :--- | :--- | :--- |
| **ROC-AUC** | **0.8770** | 非常に高い識別能力を持っています。 |
| **PR-AUC** | **0.2889** | 不均衡データとしては良好なベースラインです。 |
| **ECE** | 0.0670 | キャリブレーション誤差も低く抑えられています。 |

### 🎯 Top-k Precision (上位予測の信頼性)
モデルが「危険である」と予測した上位地点の実際に事故が発生した割合です。

*   **Top 100件**: **99.0%** (99/100件正解) - ほぼ完璧に特定できています。
*   **Top 500件**: **97.6%** (488/500件正解) - 範囲を広げても極めて高い精度を維持しています。
*   **Top 1000件**: **94.1%** (941/1000件正解)

### 📊 閾値別の挙動
*   **Recall 99%重視**: 閾値 0.0013, Precision 0.94%
    *   見逃しを極限まで減らそうとすると、偽陽性が大量に発生します。
*   **バランス重視 (Threshold 0.5)**: Precision 36.8%, Recall 27.0%
    *   F1スコアは 0.311 となります。

## 3. 学習プロセスの分析
*   **学習時間**: 83.8秒（CPU環境）
*   **収束**: 50エポック設定に対し、43エポックでEarly Stopping（忍耐値15）が発動。実質的に28エポック目でベストスコア（Val AUC=0.8767）を達成しており、学習は安定的かつ高速です。
*   **過学習**: Train LossとVal Lossの乖離も小さく、適切に学習できています。

## 4. 課題と今後の対策

### ❌ kNN-GNNモデルのエラー
*   **原因**: PyTorch GeometricのGNNモデルにおいて、学習時（Train）に構築したエッジインデックスと、検証時（Val/Test）のノード数が一致しない「Transductive」な設定になっていました。未知のノード（Testデータ）に対して推論する「Inductive」な設定に修正する必要があります。
*   **対策**: バッチごとにサブグラフを構築する `NeighborLoader` を導入するか、各サンプルの近傍だけで完結するようなアーキテクチャに変更します。

### 🚀 次のアクション
1.  **MLPのさらなる改善**: より多くの時系列特徴量や交互作用特徴量を追加。
2.  **GNNの修正**: Inductive設定へのコード改修。
3.  **アンサンブル**: Stage 1のLightGBM/CatBoostとのアンサンブル検証。
