# 交通事故予測モデル比較実験 (Robust Comparison) 結果レポート

## 1. 実験概要 (Robust Setup)

「死亡事故」の発生を予測するモデルについて、3つのアルゴリズム（Logistic Regression, Random Forest, LightGBM）を「厳密な公平性」の元で比較しました。

### 比較条件
*   **データリーク防止**: 交差検証 (5-Fold CV) のループ内部でスケーリングとエンコーディングを実行。
*   **公平な前処理**:
    *   **Logistic Regression**: TargetEncoder + StandardScaler (多重共線性・順序誤認を回避)
    *   **Random Forest**: OrdinalEncoder (ツリーに最適)
    *   **LightGBM**: Native Categorical Support + Early Stopping
*   **評価指標**:
    *   **PR-AUC (重要)**: 不均衡データに強い指標
    *   ROC-AUC
    *   Recall (見逃し防止)
    *   F1-Score

## 2. 最終結果サマリ

| 順位 | モデル | PR-AUC (重要) | ROC-AUC | Recall (再現率) | Precision | 備考 |
| :---: | :--- | :---: | :---: | :---: | :---: | :--- |
| 🥇 | **Random Forest** | **0.125** | **0.888** | **0.758** | 0.042 | 圧倒的1位。死亡事故の75%以上を検知可能。 |
| 🥈 | LightGBM | 0.075 | 0.827 | 0.006 | **0.362** | 精度は高いが見逃しが多すぎる(0.6%)。今回の設定では安全用途に不向き。 |
| 🥉 | Logistic Regression | 0.072 | 0.824 | 0.717 | 0.028 | Recallは健闘したが、線形モデルの限界で全体の識別力(PR-AUC)が伸びず。 |
| - | *Baseline (MostFreq)* | 0.009 | 0.500 | 0.000 | 0.000 | 全て「生存」と予測した場合。 |

### 考察

#### Random Forestの圧勝
*   非線形の複雑な関係性（地形、天気、道路構造の組み合わせ）を最も適切に捉えています。
*   `class_weight='balanced'` が効果的に機能しており、高い再現率 (75%) を達成しました。

#### LightGBMの苦戦
*   Early Stopping が効きすぎて、「無難な（多数派の）予測」に収束してしまった可能性があります。
*   閾値をデフォルトの 0.5 から大幅に下げることで改善する余地がありますが、デフォルト性能ではRFに劣りました。

#### Low Precision (4%) の課題
*   RFとLogRegは再現率が高い反面、Precisionが非常に低いです。
*   これは「安全」なケースの一部を「危険」と過剰に警告している状態です。
*   **改善案**: 閾値調整（Threshold Tuning）。0.5 ではなく 0.8〜0.9 付近を判定ラインにすることで、Recallを保ちつつPrecisionを向上可能です。

## 3. 推奨アクション

### 採用モデル: **Random Forest**

### ネクストステップ
1.  **閾値の最適化**:
    *   `analyze_thresholds.py` を用いて、実運用に耐えうる Precision/Recall バランス（例: Recall 60% / Precision 15% など）を見つける。
2.  **特徴量重要度分析**:
    *   RFが「何を見て危険と判断したか」をSHAPまたはFeature Importanceで深掘りし、事故防止のインサイトを得る。
