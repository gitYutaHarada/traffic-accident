# 地理空間クラスタリングの深化：ホットスポット分析 実装計画

## 📍 目的

既存のエリアID化（MiniBatchKMeans）をさらに発展させ、**統計的に有意な事故多発地点（ホットスポット）**を検出する。これにより、重点的な交通安全対策が必要な地域を科学的根拠に基づいて特定する。

---

## 🔬 手法の概要

### 1. DBSCANクラスタリング
**目的**: 地理的に近接し、かつ事故密度が高い地点をクラスタとして検出

**特徴**:
- MiniBatchKMeansと異なり、**クラスタ数を事前に指定しない**
- 密度が低い地点は「ノイズ」として除外される
- 不規則な形状のクラスタも検出可能

**パラメータ**:
- `eps`: 近傍とみなす距離（例: 500m = 0.005度）
- `min_samples`: クラスタを形成する最小事故件数（例: 20件）

### 2. Getis-Ord Gi* 統計量
**目的**: 各地点が統計的に有意な「ホットスポット」か「コールドスポット」かを判定

**原理**:
- 周辺地域と比較して、その地点の死亡事故率が有意に高いかを検定
- Z値が+1.96以上なら「ホットスポット（危険地帯）」（有意水準5%）
- Z値が-1.96以下なら「コールドスポット（安全地帯）」

**メリット**:
- 単なる事故件数でなく、**統計的有意性**を考慮
- 偶然の集中と真のホットスポットを区別

---

## 📊 実装手順

### Phase 1: データ準備
1. 緯度経度を10進数に変換（既存の`create_model_dataset.py`から流用）
2. 死亡事故（`死者数=1`）のみを抽出
3. 座標データ（緯度・経度）と死亡フラグを準備

### Phase 2: DBSCANクラスタリング
```python
from sklearn.cluster import DBSCAN

# 緯度経度でクラスタリング
dbscan = DBSCAN(eps=0.005, min_samples=20, metric='haversine')
clusters = dbscan.fit_predict(coords)
```

**出力**:
- クラスタID（-1はノイズ）
- クラスタごとの事故件数、死亡率

### Phase 3: Getis-Ord Gi* 統計量の計算
```python
from esda.getisord import G_Local

# 空間重み行列の作成（距離ベース）
w = weights.DistanceBand.from_array(coords, threshold=0.01)

# Gi*統計量の計算
gi_star = G_Local(death_flags, w)
```

**出力**:
- 各地点のZ値
- p値（統計的有意性）
- ホットスポット判定（Z > 1.96）

### Phase 4: 可視化
1. **地図上にプロット**:
   - ホットスポット: 赤
   - コールドスポット: 青
   - 通常地点: 灰色

2. **ヒートマップ**:
   - Foliumライブラリで対話的な地図を作成

3. **統計サマリー**:
   - ホットスポット数、平均死亡率、対象エリア

---

## 📁 実装ファイル構成

```
scripts/analysis/
  └── hotspot_analysis.py          # ホットスポット分析メインスクリプト

results/
  ├── experiments/
  │   └── hotspot_analysis.md      # 分析結果レポート
  ├── visualizations/
  │   ├── dbscan_clusters.png      # DBSCANクラスタ可視化
  │   ├── hotspot_map.png          # ホットスポット地図
  │   └── hotspot_map.html         # 対話的地図（Folium）
  └── analysis/
      └── hotspot_summary.csv      # ホットスポット一覧
```

---

## 🎯 期待される成果

### 1. 学術的貢献
- 既存のエリアID化（教師なし学習）に加え、**統計的検定による客観的根拠**を提供
- 「なぜこのエリアが危険か」を定量的に説明可能

### 2. 実務的価値
- 警察の重点パトロール地域の選定
- 道路改善（信号、標識、照明）の優先順位付け
- 地域住民への注意喚起

### 3. 論文への貢献
**既存のエリアID化との差別化**:

| アプローチ | 目的 | 手法 |
|------------|------|------|
| エリアID化（既存） | モデルの予測精度向上 | MiniBatchKMeans（教師なし） |
| ホットスポット分析（新規） | 危険地域の科学的特定 | DBSCAN + 統計的検定 |

→ **両方を組み合わせることで「予測」と「解釈」の両立**を実現

---

## ⏱️ 所要時間（見積もり）

| フェーズ | 所要時間 |
|----------|----------|
| データ準備 | 30分 |
| DBSCANクラスタリング | 1時間 |
| Getis-Ord Gi*統計量 | 1.5時間 |
| 可視化 | 1時間 |
| レポート作成 | 1時間 |
| **合計** | **約5時間** |

---

## 📦 必要なライブラリ

```bash
pip install scikit-learn pysal esda libpysal folium geopandas
```

---

## 🚀 次のステップ

1. この計画書をレビュー
2. 実装スクリプト `scripts/analysis/hotspot_analysis.py` の作成
3. 実行・結果の評価
4. 論文への統合

---

**作成日**: 2025年12月7日  
**担当**: Antigravity
