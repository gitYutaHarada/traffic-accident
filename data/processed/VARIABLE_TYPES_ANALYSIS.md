# 変数型分類分析（Variable Types Analysis）

## データセット: honhyo_clean_predictable_only.csv

コードブック（`codebook_extracted.txt`）を基に、全33カラムをカテゴリカル変数と数値変数に分類します。

---

## 📊 カテゴリカル変数（Categorical Variables）- 28カラム

### 1. 交通規制・施設関連（7カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 1 | ゾーン規制 | 1, 70 | 1=ゾーン30, 70=規制なし |
| 2 | 一時停止規制　標識（当事者A） | 0-9 | 0=対象外, 1-8=標識種類, 9=規制なし |
| 3 | 一時停止規制　標識（当事者B） | 0-9 | 同上 |
| 4 | 一時停止規制　表示（当事者A） | 0, 21, 22 | 0=対象外, 21=表示あり, 22=表示なし |
| 5 | 一時停止規制　表示（当事者B） | 0, 21, 22 | 同上 |
| 6 | 中央分離帯施設等 | 0-7 | 0=一般交通の場所, 1-5=施設種類 |
| 8 | 信号機 | 1-7 | 1-6=信号機種類, 7=施設なし |

### 2. 事故状況（2カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 7 | 事故類型 | 1, 21, 41, 61 | 1=人対車両, 21=車両相互, 41=車両単独, 61=列車 |
| 23 | 衝突地点 | 1, 20, 30 | 1=単路, 20=その他, 30=交差点内 |

### 3. 環境条件（3カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 9 | 地形 | 1-3 | 1-2=市街地, 3=非市街地 |
| 13 | 天候 | 1-5 | 1=晴, 2=曇, 3=雨, 4=霧, 5=雪 |
| 17 | 昼夜 | 11-13, 21-23 | 11-13=昼, 21-23=夜 |

### 4. 時間関連（3カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 18 | 曜日(発生年月日) | 1-7 | 1=日, 2=月, ..., 7=土 |
| 22 | 祝日(発生年月日) | 1-3 | 1=当日, 2=前日, 3=その他 |
| 33 | 発生日時 | 日時文字列 | YYYY-MM-DD HH:MM:SS形式 ※要変換 |

### 5. 道路構造（6カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 19 | 歩車道区分 | 1-4 | 1-3=区分あり, 4=区分なし |
| 26 | 路面状態 | 1-5 | 1-4=舗装（乾燥/湿潤/凍結/積雪）, 5=非舗装 |
| 27 | 車道幅員 | 0-6, 11-19 | 0=一般交通の場所, 1-6=単路, 11-19=交差点 |
| 30 | 道路形状 | 0-37 | 0=一般交通の場所, 1-37=形状種類 |
| 31 | 道路線形 | 0-9 | 0=一般交通の場所, 1-9=線形種類 |
| 25 | 路線コード | 0-9900 | 道路種別コード（4桁+1桁） |

### 6. 当事者関連（4カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 15 | 年齢（当事者A） | 0-75 | 0=不明, 1-75=年齢層 |
| 16 | 当事者種別（当事者A） | 0-76 | 0=対象外, 1-76=車両/歩行者種別 |
| 21 | 用途別（当事者A） | 0-41 | 0=対象外, 1=事業用, 31=自家用, 41=自転車 |
| 28 | 速度規制（指定のみ）（当事者A） | 0-12 | 0=対象外, 1-8=規制速度, 10=規制なし |
| 29 | 速度規制（指定のみ）（当事者B） | 0-12 | 同上 |

### 7. 地理コード（3カラム）
| # | カラム名 | コード範囲 | 説明 |
|---|---------|-----------|------|
| 14 | 市区町村コード | 5桁コード | 総務省標準地域コード |
| 24 | 警察署等コード | コード | 警察署識別コード |
| 32 | 都道府県コード | 10-97 | 都道府県識別コード |

---

## 🔢 数値変数（Numerical Variables）- 3カラム

| # | カラム名 | 型 | 説明 |
|---|---------|---|------|
| 10 | 地点　経度（東経） | 連続値 | 世界測地系（度分秒）→度に変換推奨 |
| 11 | 地点　緯度（北緯） | 連続値 | 世界測地系（度分秒）→度に変換推奨 |
| 12 | 地点コード | 整数 | キロポスト（直轄国道のみ、それ以外は0） |

---

## 🎯 目的変数

| # | カラム名 | 型 | 説明 |
|---|---------|---|------|
| 20 | 死者数 | バイナリ | 0=負傷のみ, 1=死亡 |

---

## 📋 LightGBM用の推奨設定

### カテゴリカル変数リスト（28個）
```python
categorical_features = [
    'ゾーン規制',
    '一時停止規制　標識（当事者A）',
    '一時停止規制　標識（当事者B）',
    '一時停止規制　表示（当事者A）',
    '一時停止規制　表示（当事者B）',
    '中央分離帯施設等',
    '事故類型',
    '信号機',
    '地形',
    '天候',
    '昼夜',
    '曜日(発生年月日)',
    '祝日(発生年月日)',
    '歩車道区分',
    '路面状態',
    '車道幅員',
    '道路形状',
    '道路線形',
    '路線コード',
    '年齢（当事者A）',
    '当事者種別（当事者A）',
    '用途別（当事者A）',
    '速度規制（指定のみ）（当事者A）',
    '速度規制（指定のみ）（当事者B）',
    '市区町村コード',
    '警察署等コード',
    '都道府県コード',
    # '発生日時', # 特徴量エンジニアリングで分解推奨
]
```

### 数値変数リスト（3個）
```python
numerical_features = [
    '地点　経度（東経）',  # 度に変換推奨
    '地点　緯度（北緯）',  # 度に変換推奨
    '地点コード',
]
```

---

## ⚠️ 注意事項

1. **発生日時**: 文字列型のため、特徴量エンジニアリングで「時間帯」「曜日」「月」などに分解することを推奨
2. **緯度経度**: 度分秒形式の場合は度（decimal degrees）に変換推奨
3. **地点コード**: 直轄国道以外は0なので、欠損値として扱うか、「0=直轄国道以外」としてカテゴリカルにするか検討
4. **路線コード**: 5桁のコードだが範囲が広い（0-9900）ため、カテゴリカルとして扱うか、上位桁のみ使用するか検討

---

## 📊 統計

- **全カラム数**: 33
- **カテゴリカル変数**: 28（84.8%）
- **数値変数**: 3（9.1%）
- **目的変数**: 1（3.0%）
- **その他（要変換）**: 1（発生日時）
